{
    "info": {
        "_postman_id": "mobile-user-assignment-email-support",
        "name": "ðŸ“± Mobile User Assignment with Email Support",
        "description": "Complete mobile user assignment API collection with email support. Import this into your existing collection or run standalone.\n\nðŸ”‘ KEY FEATURES:\nâ€¢ Assign users by email address (no UUID lookup needed)\nâ€¢ Remove users by email address (mobile-friendly)\nâ€¢ Comprehensive permission testing\nâ€¢ Mobile-optimized responses\nâ€¢ Backward compatible with existing admin APIs\n\nðŸ“§ EMAIL SUPPORT:\nâ€¢ POST /api/mobile/projects/{id}/users with {\"email\": \"user@example.com\"}\nâ€¢ DELETE /api/mobile/projects/{id}/users with {\"email\": \"user@example.com\"}\nâ€¢ Automatic user validation and clear error messages",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "item": [
        {
            "name": "ðŸ‘¥ Mobile User Assignment with Email Support",
            "description": "Complete mobile user assignment testing with email and ID support",
            "item": [
                {
                    "name": "ðŸ“‹ List Project Users (Mobile)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "const response = pm.response.json();",
                                    "",
                                    "pm.test('Project users listed successfully', () => {",
                                    "    pm.expect(response.success).to.be.true;",
                                    "});",
                                    "",
                                    "if (response.success && response.data.assignments) {",
                                    "    console.log('ðŸ‘¥ Mobile Project Users:');",
                                    "    console.log(`ðŸ“Š Total users assigned: ${response.data.totalCount}`);",
                                    "    ",
                                    "    response.data.assignments.forEach((assignment, index) => {",
                                    "        console.log(`${index + 1}. ${assignment.assigned_user.email} (${assignment.assigned_user.role})`);",
                                    "        console.log(`   ðŸ“… Assigned: ${new Date(assignment.assigned_at).toLocaleDateString()}`);",
                                    "    });",
                                    "    ",
                                    "    // Store user data for testing removal",
                                    "    if (response.data.assignments.length > 0) {",
                                    "        pm.environment.set('test_user_to_remove', response.data.assignments[0].assigned_user.id);",
                                    "        pm.environment.set('test_user_email_to_remove', response.data.assignments[0].assigned_user.email);",
                                    "    }",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{admin_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/mobile/projects/{{admin_project_id}}/users",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "projects",
                                "{{admin_project_id}}",
                                "users"
                            ]
                        }
                    }
                },
                {
                    "name": "ðŸ“§ Assign User by Email (Admin)",
                    "event": [
                        {
                            "listen": "prerequest",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "console.log('');",
                                    "console.log('ðŸ“§ USER ASSIGNMENT BY EMAIL TEST');",
                                    "console.log('Project ID:', pm.variables.get('admin_project_id'));",
                                    "console.log('Note: Set {{user_email_to_assign}} variable to test assignment');",
                                    "console.log('');"
                                ]
                            }
                        },
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "const response = pm.response.json();",
                                    "",
                                    "pm.test('User assignment by email response received', () => {",
                                    "    pm.expect([200, 400, 404]).to.include(pm.response.code);",
                                    "});",
                                    "",
                                    "if (response.success && response.data.assignment) {",
                                    "    console.log('âœ… User Assignment by Email Success:');",
                                    "    console.log(`ðŸ‘¤ User: ${response.data.assignment.assigned_user.email}`);",
                                    "    console.log(`ðŸŽ­ Role: ${response.data.assignment.assigned_user.role}`);",
                                    "    console.log(`ðŸ“… Assigned: ${new Date(response.data.assignment.assigned_at).toLocaleString()}`);",
                                    "    console.log(`ðŸ“§ Method: ${response.data.assignedBy} (email lookup)`);",
                                    "    console.log(`ðŸ’¬ Message: ${response.message}`);",
                                    "    ",
                                    "    pm.environment.set('assigned_user_id', response.data.assignment.assigned_user.id);",
                                    "    pm.environment.set('assigned_user_email', response.data.assignment.assigned_user.email);",
                                    "} else if (!response.success && pm.response.code === 400) {",
                                    "    console.log('â„¹ï¸ User already assigned:', response.message);",
                                    "} else if (!response.success && pm.response.code === 404) {",
                                    "    console.log('âŒ User not found with provided email');",
                                    "} else {",
                                    "    console.log('âŒ Assignment failed:', response.error || 'Unknown error');",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{admin_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"email\": \"{{user_email_to_assign}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/mobile/projects/{{admin_project_id}}/users",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "projects",
                                "{{admin_project_id}}",
                                "users"
                            ]
                        }
                    }
                },
                {
                    "name": "âž• Assign User by ID (Admin)",
                    "event": [
                        {
                            "listen": "prerequest",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "console.log('');",
                                    "console.log('ðŸ‘¥ USER ASSIGNMENT BY ID TEST');",
                                    "console.log('Project ID:', pm.variables.get('admin_project_id'));",
                                    "console.log('Note: Set {{user_id_to_assign}} variable to test assignment');",
                                    "console.log('');"
                                ]
                            }
                        },
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "const response = pm.response.json();",
                                    "",
                                    "pm.test('User assignment by ID response received', () => {",
                                    "    pm.expect([200, 400]).to.include(pm.response.code);",
                                    "});",
                                    "",
                                    "if (response.success && response.data.assignment) {",
                                    "    console.log('âœ… User Assignment by ID Success:');",
                                    "    console.log(`ðŸ‘¤ User: ${response.data.assignment.assigned_user.email}`);",
                                    "    console.log(`ðŸŽ­ Role: ${response.data.assignment.assigned_user.role}`);",
                                    "    console.log(`ðŸ“… Assigned: ${new Date(response.data.assignment.assigned_at).toLocaleString()}`);",
                                    "    console.log(`ðŸ“ Method: ${response.data.assignedBy}`);",
                                    "    console.log(`ðŸ’¬ Message: ${response.message}`);",
                                    "    ",
                                    "    pm.environment.set('assigned_user_id', response.data.assignment.assigned_user.id);",
                                    "} else if (!response.success && pm.response.code === 400) {",
                                    "    console.log('â„¹ï¸ User already assigned or validation error');",
                                    "} else {",
                                    "    console.log('âŒ Assignment failed:', response.error || 'Unknown error');",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{admin_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"userId\": \"{{user_id_to_assign}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/mobile/projects/{{admin_project_id}}/users",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "projects",
                                "{{admin_project_id}}",
                                "users"
                            ]
                        }
                    }
                },
                {
                    "name": "ðŸš« Assign User by Email (User Role - Should Fail)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "const response = pm.response.json();",
                                    "const blocked = !response.success && pm.response.code === 403;",
                                    "",
                                    "console.log('ðŸš« USER EMAIL ASSIGNMENT PERMISSION TEST:');",
                                    "console.log(`ðŸ“§ Assignment by email attempt: ${pm.response.code}`);",
                                    "console.log(`âœ… Expected: Should be BLOCKED (403)`);",
                                    "console.log(`ðŸŽ¯ Result: ${blocked ? 'CORRECTLY BLOCKED âœ¨' : 'INCORRECTLY ALLOWED âŒ'}`);",
                                    "",
                                    "if (!blocked) {",
                                    "    console.log('âš ï¸ SECURITY ISSUE: Regular user was able to assign users by email!');",
                                    "}",
                                    "",
                                    "pm.test('Regular users cannot assign users by email', () => {",
                                    "    pm.expect(pm.response.code).to.equal(403);",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{user_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"email\": \"{{user_email_to_assign}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/mobile/projects/{{admin_project_id}}/users",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "projects",
                                "{{admin_project_id}}",
                                "users"
                            ]
                        }
                    }
                },
                {
                    "name": "ðŸ“§ Remove User by Email (Admin)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "const response = pm.response.json();",
                                    "",
                                    "pm.test('User removal by email response received', () => {",
                                    "    pm.expect([200, 404]).to.include(pm.response.code);",
                                    "});",
                                    "",
                                    "if (response.success) {",
                                    "    console.log('âœ… User Removal by Email Success:');",
                                    "    console.log(`ðŸ‘¤ Removed: ${response.data.removedUser.email}`);",
                                    "    console.log(`ðŸ“§ Method: ${response.data.removedBy} (email lookup)`);",
                                    "    console.log(`ðŸ’¬ Message: ${response.message}`);",
                                    "} else if (pm.response.code === 404) {",
                                    "    console.log('âŒ User not found with provided email');",
                                    "} else {",
                                    "    console.log('âŒ User removal failed:', response.error || 'Unknown error');",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{admin_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "DELETE",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"email\": \"{{assigned_user_email}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/mobile/projects/{{admin_project_id}}/users",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "projects",
                                "{{admin_project_id}}",
                                "users"
                            ]
                        }
                    }
                },
                {
                    "name": "âž– Remove User by ID (Admin)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "const response = pm.response.json();",
                                    "",
                                    "pm.test('User removal by ID response received', () => {",
                                    "    pm.expect([200, 404]).to.include(pm.response.code);",
                                    "});",
                                    "",
                                    "if (response.success) {",
                                    "    console.log('âœ… User Removal by ID Success:');",
                                    "    console.log(`ðŸ‘¤ Removed: ${response.data.removedUser.email}`);",
                                    "    console.log(`ðŸ“ Method: ${response.data.removedBy}`);",
                                    "    console.log(`ðŸ’¬ Message: ${response.message}`);",
                                    "} else {",
                                    "    console.log('âŒ User removal failed:', response.error || 'Unknown error');",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{admin_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "DELETE",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"userId\": \"{{assigned_user_id}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/mobile/projects/{{admin_project_id}}/users",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "projects",
                                "{{admin_project_id}}",
                                "users"
                            ]
                        }
                    }
                },
                {
                    "name": "ðŸ“Š Mobile Email Assignment Summary",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "type": "text/javascript",
                                "exec": [
                                    "console.log('');",
                                    "console.log('ðŸ“± MOBILE USER ASSIGNMENT WITH EMAIL SUPPORT:');",
                                    "console.log('=============================================');",
                                    "console.log('| Feature           | Traditional API | Mobile API |');",
                                    "console.log('|-------------------|-----------------|------------|');",
                                    "console.log('| Assign by ID      |       âœ…        |     âœ…     |');",
                                    "console.log('| Assign by Email   |       âŒ        |     âœ…     |');",
                                    "console.log('| Remove by ID      |       âœ…        |     âœ…     |');",
                                    "console.log('| Remove by Email   |       âŒ        |     âœ…     |');",
                                    "console.log('| Mobile Optimized  |       âŒ        |     âœ…     |');",
                                    "console.log('| Admin Panel Safe  |       âœ…        |     âœ…     |');",
                                    "console.log('=============================================');",
                                    "console.log('');",
                                    "console.log('ðŸ”§ MOBILE ENDPOINTS WITH EMAIL SUPPORT:');",
                                    "console.log('â€¢ GET /api/mobile/projects/{id}/users - List users');",
                                    "console.log('â€¢ POST /api/mobile/projects/{id}/users - Assign by ID or email');",
                                    "console.log('â€¢ DELETE /api/mobile/projects/{id}/users - Remove by ID or email');",
                                    "console.log('');",
                                    "console.log('ðŸ“§ EMAIL ASSIGNMENT EXAMPLES:');",
                                    "console.log('â€¢ POST: {\"email\": \"user@company.com\"} - Assign by email');",
                                    "console.log('â€¢ DELETE: {\"email\": \"user@company.com\"} - Remove by email');",
                                    "console.log('â€¢ POST: {\"userId\": \"uuid-here\"} - Traditional method still works');",
                                    "console.log('');",
                                    "console.log('ðŸŽ¯ BENEFITS FOR MOBILE DEVELOPMENT:');",
                                    "console.log('â€¢ No more complex user ID lookups required');",
                                    "console.log('â€¢ Better UX - users think in terms of emails');",
                                    "console.log('â€¢ Simplified mobile app integration');",
                                    "console.log('â€¢ Clear error messages for non-existent emails');",
                                    "console.log('â€¢ Admin panel functionality completely preserved');",
                                    "console.log('');",
                                    "console.log('âœ… All mobile email assignment tests should pass!');",
                                    "",
                                    "pm.test('Mobile email assignment documentation verified', () => {",
                                    "    pm.expect(true).to.be.true;",
                                    "});"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{admin_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/mobile/projects/{{admin_project_id}}/users",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "projects",
                                "{{admin_project_id}}",
                                "users"
                            ]
                        }
                    }
                }
            ]
        }
    ],
    "variable": [
        {
            "key": "base_url",
            "value": "http://localhost:3000",
            "type": "string"
        },
        {
            "key": "admin_project_id",
            "value": "YOUR_PROJECT_ID_HERE",
            "type": "string",
            "description": "Set this to a valid project ID"
        },
        {
            "key": "user_email_to_assign",
            "value": "user@example.com",
            "type": "string",
            "description": "Set this to a valid user email address to test email-based assignment"
        },
        {
            "key": "user_id_to_assign",
            "value": "USER_UUID_HERE",
            "type": "string",
            "description": "Set this to a valid user UUID to test ID-based assignment"
        },
        {
            "key": "assigned_user_id",
            "value": "",
            "type": "string",
            "description": "Automatically populated with assigned user ID for removal testing"
        },
        {
            "key": "assigned_user_email",
            "value": "",
            "type": "string",
            "description": "Automatically populated with assigned user email for removal testing"
        }
    ]
}