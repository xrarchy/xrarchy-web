{
    "info": {
        "_postman_id": "archy-xr-mobile-api-final",
        "name": "Archy XR Mobile API - Final",
        "description": "Production-ready mobile API collection for Archy XR with authentication, projects, and file management.",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "auth": {
        "type": "bearer",
        "bearer": [
            {
                "key": "token",
                "value": "{{access_token}}",
                "type": "string"
            }
        ]
    },
    "event": [
        {
            "listen": "prerequest",
            "script": {
                "type": "text/javascript",
                "exec": [
                    "console.log('üöÄ Request:', pm.info.requestName);"
                ]
            }
        },
        {
            "listen": "test",
            "script": {
                "type": "text/javascript",
                "exec": [
                    "const response = pm.response.json();",
                    "if (response.success) {",
                    "    console.log('‚úÖ', pm.info.requestName, 'successful');",
                    "} else {",
                    "    console.log('‚ùå', pm.info.requestName, 'failed:', response.error);",
                    "}",
                    "pm.test('Response has success field', () => {",
                    "    pm.expect(response).to.have.property('success');",
                    "});"
                ]
            }
        }
    ],
    "item": [
        {
            "name": "üîê Authentication",
            "item": [
                {
                    "name": "Register User",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "const response = pm.response.json();",
                                    "if (response.success && response.data.user) {",
                                    "    pm.environment.set('user_id', response.data.user.id);",
                                    "    pm.environment.set('user_email', response.data.user.email);",
                                    "    console.log('üë§ User registered:', response.data.user.email);",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"email\": \"{{test_email}}\",\n  \"password\": \"{{test_password}}\",\n  \"role\": \"User\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/mobile/auth/register",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "auth",
                                "register"
                            ]
                        }
                    }
                },
                {
                    "name": "Confirm Email (Helper)",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"email\": \"{{test_email}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/auth/manual-confirm",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "auth",
                                "manual-confirm"
                            ]
                        }
                    }
                },
                {
                    "name": "Login User",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "const response = pm.response.json();",
                                    "if (response.success && response.data.session) {",
                                    "    pm.environment.set('access_token', response.data.session.accessToken);",
                                    "    pm.environment.set('refresh_token', response.data.session.refreshToken);",
                                    "    pm.environment.set('user_role', response.data.user.role);",
                                    "    console.log('üîë Login successful for:', response.data.user.email);",
                                    "    console.log('üë§ Role:', response.data.user.role);",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"email\": \"{{test_email}}\",\n  \"password\": \"{{test_password}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/mobile/auth/login",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "auth",
                                "login"
                            ]
                        }
                    }
                },
                {
                    "name": "Login Admin",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "const response = pm.response.json();",
                                    "if (response.success && response.data.session) {",
                                    "    pm.environment.set('admin_token', response.data.session.accessToken);",
                                    "    pm.environment.set('admin_refresh', response.data.session.refreshToken);",
                                    "    console.log('üëë Admin login successful:', response.data.user.email);",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"email\": \"{{admin_email}}\",\n  \"password\": \"{{admin_password}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/mobile/auth/login",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "auth",
                                "login"
                            ]
                        }
                    }
                },
                {
                    "name": "Login Archivist",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "const response = pm.response.json();",
                                    "if (response.success && response.data.session) {",
                                    "    pm.environment.set('archivist_token', response.data.session.accessToken);",
                                    "    pm.environment.set('archivist_refresh', response.data.session.refreshToken);",
                                    "    console.log('üìö Archivist login successful:', response.data.user.email);",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"email\": \"{{archivist_email}}\",\n  \"password\": \"{{archivist_password}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/mobile/auth/login",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "auth",
                                "login"
                            ]
                        }
                    }
                },
                {
                    "name": "Get Profile",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/mobile/auth/profile",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "auth",
                                "profile"
                            ]
                        }
                    }
                },
                {
                    "name": "Refresh Token",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "const response = pm.response.json();",
                                    "if (response.success && response.data.session) {",
                                    "    pm.environment.set('access_token', response.data.session.accessToken);",
                                    "    pm.environment.set('refresh_token', response.data.session.refreshToken);",
                                    "    console.log('üîÑ Token refreshed successfully');",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "noauth"
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"refreshToken\": \"{{refresh_token}}\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/mobile/auth/refresh",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "auth",
                                "refresh"
                            ]
                        }
                    }
                },
                {
                    "name": "Logout",
                    "request": {
                        "method": "POST",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/mobile/auth/logout",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "auth",
                                "logout"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "üìÅ Projects",
            "item": [
                {
                    "name": "List Projects",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "const response = pm.response.json();",
                                    "if (response.success && response.data.projects.length > 0) {",
                                    "    pm.environment.set('project_id', response.data.projects[0].id);",
                                    "    console.log('üìÅ Projects found:', response.data.totalCount);",
                                    "    console.log('üíæ Saved project ID:', response.data.projects[0].id);",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/mobile/projects",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "projects"
                            ]
                        }
                    }
                },
                {
                    "name": "Create Project (Admin)",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "const response = pm.response.json();",
                                    "if (response.success && response.data.project) {",
                                    "    pm.environment.set('new_project_id', response.data.project.id);",
                                    "    console.log('‚úÖ Project created:', response.data.project.name);",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{admin_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"name\": \"Postman Test Project\",\n  \"description\": \"Created via Postman for testing\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/mobile/projects",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "projects"
                            ]
                        }
                    }
                },
                {
                    "name": "Get Project Details",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/mobile/projects/{{project_id}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "projects",
                                "{{project_id}}"
                            ]
                        }
                    }
                },
                {
                    "name": "Update Project (Admin)",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "{{admin_token}}",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"name\": \"Updated Project Name\",\n  \"description\": \"Updated via Postman\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/mobile/projects/{{project_id}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "projects",
                                "{{project_id}}"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "üìé Files",
            "item": [
                {
                    "name": "List Project Files",
                    "request": {
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/mobile/projects/{{project_id}}/files",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "projects",
                                "{{project_id}}",
                                "files"
                            ]
                        }
                    }
                },
                {
                    "name": "Upload File",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "const response = pm.response.json();",
                                    "if (response.success && response.data.file) {",
                                    "    console.log('üì§ File uploaded:', response.data.file.name);",
                                    "    console.log('üíæ File size:', response.data.file.size, 'bytes');",
                                    "}"
                                ]
                            }
                        }
                    ],
                    "request": {
                        "method": "POST",
                        "header": [],
                        "body": {
                            "mode": "formdata",
                            "formdata": [
                                {
                                    "key": "file",
                                    "type": "file",
                                    "src": [],
                                    "description": "Select a file to upload (max 10MB)"
                                },
                                {
                                    "key": "fileName",
                                    "value": "postman-test-file.txt",
                                    "type": "text"
                                }
                            ]
                        },
                        "url": {
                            "raw": "{{base_url}}/api/mobile/projects/{{project_id}}/files",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "projects",
                                "{{project_id}}",
                                "files"
                            ]
                        }
                    }
                }
            ]
        },
        {
            "name": "üîí Permission Tests",
            "item": [
                {
                    "name": "User Try Create Project (Should Fail)",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n  \"name\": \"Unauthorized Project\",\n  \"description\": \"This should fail\"\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/mobile/projects",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "projects"
                            ]
                        }
                    }
                },
                {
                    "name": "Invalid Token Test",
                    "request": {
                        "auth": {
                            "type": "bearer",
                            "bearer": [
                                {
                                    "key": "token",
                                    "value": "invalid_token_here",
                                    "type": "string"
                                }
                            ]
                        },
                        "method": "GET",
                        "header": [],
                        "url": {
                            "raw": "{{base_url}}/api/mobile/auth/profile",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "mobile",
                                "auth",
                                "profile"
                            ]
                        }
                    }
                }
            ]
        }
    ],
    "variable": [
        {
            "key": "base_url",
            "value": "http://localhost:3000",
            "type": "string"
        },
        {
            "key": "test_email",
            "value": "postman-test@example.com",
            "type": "string"
        },
        {
            "key": "test_password",
            "value": "postman123",
            "type": "string"
        },
        {
            "key": "admin_email",
            "value": "cinani1527@cotasen.com",
            "type": "string"
        },
        {
            "key": "admin_password",
            "value": "cinani1527",
            "type": "string"
        },
        {
            "key": "archivist_email",
            "value": "widijiy440@discrip.com",
            "type": "string"
        },
        {
            "key": "archivist_password",
            "value": "widijiy440",
            "type": "string"
        }
    ]
}